(window.webpackJsonp=window.webpackJsonp||[]).push([[197],{632:function(t,a,s){"use strict";s.r(a);var e=s(23),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"trans-ast"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#trans-ast"}},[t._v("#")]),t._v(" trans-ast")]),t._v(" "),s("h2",{attrs:{id:"遇到的问题"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#遇到的问题"}},[t._v("#")]),t._v(" 遇到的问题")]),t._v(" "),s("p",[t._v("在中医项目使用html作为模板保存病例,前端需要解析大量html字符串,进行自定义属性,样式,类型等操作,原生dom操作造成载入模板耗时过长的问题")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/mbtree.png",alt:"img"}})]),t._v(" "),s("h2",{attrs:{id:"需要解析做的事情"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#需要解析做的事情"}},[t._v("#")]),t._v(" 需要解析做的事情")]),t._v(" "),s("ol",[s("li",[t._v("解析html字符串,拿到所有元素的sid和id,请求接口得到对应元素的内容")]),t._v(" "),s("li",[t._v("根据接口返回参数设置对应的元素的类型:"),s("s",[t._v("date")]),t._v(","),s("s",[t._v("datetime")]),t._v(",text,select,checkbox,radio")]),t._v(" "),s("li",[t._v("如类型不是text,则解析待选项list,设置给对应元素")])]),t._v(" "),s("div",[t._v("\n    如图示例:\n    "),s("img",{staticStyle:{"text-algin":"center"},attrs:{src:"/img/event.png",height:"750",width:"1030"}})]),t._v(" "),s("h2",{attrs:{id:"解析html字符串的方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#解析html字符串的方式"}},[t._v("#")]),t._v(" 解析html字符串的方式")]),t._v(" "),s("ol",[s("li",[s("p",[t._v("createDocumentFragment()\n转换为文档片段,进行dom操作,解析后返回")])]),t._v(" "),s("li",[s("p",[t._v("createElement()\n转换为真实dom操作")])])]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("renderHtml"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("vue")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" fragment "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createDocumentFragment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// or")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" parentElement "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'div'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  parentElement"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("innerHTML "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" renderHtml"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// todo..")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br")])]),s("div",[t._v("\n👇🏻👇🏻👇🏻解析后的数据,原生DOM\n    "),s("img",{staticStyle:{"text-algin":"center"},attrs:{src:"/img/111.png",height:"",width:"800"}})]),t._v(" "),s("h2",{attrs:{id:"缺点"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#缺点"}},[t._v("#")]),t._v(" 缺点")]),t._v(" "),s("ol",[s("li",[t._v("不方便操作自定义属性和内容,层级混乱,获取与设置麻烦")]),t._v(" "),s("li",[t._v("操作原生dom不符合mvvm框架思想,代码流程长且复杂")]),t._v(" "),s("li",[t._v("效率较低"),s("br"),t._v(" "),s("img",{attrs:{src:"/img/context.png",alt:"img"}}),t._v(" "),s("img",{attrs:{src:"/img/dm1.png",alt:"img"}}),t._v(" "),s("img",{attrs:{src:"/img/dm2.png",alt:"img"}})])]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("dom操作胃炎模板,随诊模板,复诊模板的初始耗时")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/old.png",alt:"img"}})])]),t._v(" "),s("h2",{attrs:{id:"解决思路"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#解决思路"}},[t._v("#")]),t._v(" 解决思路")]),t._v(" "),s("blockquote",[s("p",[t._v("参考虚拟dom,用js对象方式模拟dom节点,进行属性操作。")])]),t._v(" "),s("p",[t._v("手动构建AST抽象语法树,采用四则运算括号匹配的相同机制,对模板进行正则解析,手动构建对象,具体流程可在我写的"),s("code",[t._v("mini-vue")]),t._v("中查看"),s("br"),t._v(" "),s("img",{attrs:{src:"/img/ast11.png",alt:"img"}})]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("ast操作操作胃炎模板,随诊模板,复诊模板的初始耗时")]),t._v(" "),s("p",[s("img",{attrs:{src:"/img/new.png",alt:"img"}})])]),t._v(" "),s("h2",{attrs:{id:"解决方法提炼成插件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#解决方法提炼成插件"}},[t._v("#")]),t._v(" 解决方法提炼成插件")]),t._v(" "),s("p",[t._v("将解决方法提炼成一个通用插件,遇到需要解析html的操作,都可以直接使用,优化效率")]),t._v(" "),s("p",[t._v("可以将html字符串解析为AST对象的一个插件,提供Template转AST,AST转DOM的功能,解析大量HTML字符串的效率相比传统DOM操作提升25倍以上")]),t._v(" "),s("h2",{attrs:{id:"安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[t._v("#")]),t._v(" 安装")]),t._v(" "),s("p",[s("code",[t._v("npm install --save trans-ast")]),s("br"),t._v("\nor"),s("br"),t._v(" "),s("code",[t._v("yarn add trans-ast")])]),t._v(" "),s("h2",{attrs:{id:"使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[t._v("#")]),t._v(" 使用")]),t._v(" "),s("p",[t._v("Node环境"),s("br"),t._v(" "),s("code",[t._v('const $AST = require("trans-ast")')])]),t._v(" "),s("p",[t._v("Vue 或 React"),s("br"),t._v(" "),s("code",[t._v("import $AST from 'trans-ast'")])]),t._v(" "),s("h2",{attrs:{id:"提供方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#提供方法"}},[t._v("#")]),t._v(" 提供方法")]),t._v(" "),s("h3",{attrs:{id:"parseast-template"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#parseast-template"}},[t._v("#")]),t._v(" parseAST(template)")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[t._v("参数")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("描述")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("template (必须)")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("String类型,合法的html字符串")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("返回值")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("描述")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("AST")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("Object类型,解析后的AST对象")])])])]),t._v(" "),s("br"),t._v(" "),s("h3",{attrs:{id:"parsedom-ast"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#parsedom-ast"}},[t._v("#")]),t._v(" parseDOM(AST)")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[t._v("参数")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("描述")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("AST (必须)")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("Object类型,由parseAST方法解析后的AST对象")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("返回值")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("描述")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("ElementNode")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("Node节点,AST转换后的DOM")])])])]),t._v(" "),s("br"),t._v(" "),s("h2",{attrs:{id:"ast属性说明"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ast属性说明"}},[t._v("#")]),t._v(" AST属性说明")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",{staticStyle:{"text-align":"left"}},[t._v("属性")]),t._v(" "),s("th",{staticStyle:{"text-align":"left"}},[t._v("描述")])])]),t._v(" "),s("tbody",[s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("attrsMap")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("Map类型的标签属性,包含自定义属性")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("attrslist")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("List类型的标签属性,包含自定义属性")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("children")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("当前元素的子元素")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("parent")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("当前元素的父元素 (已废弃)")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("tag")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("标签名称")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("type")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("1:元素 2:文本")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("expression")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("可执行字符串,后续版本会支持直接解析")])]),t._v(" "),s("tr",[s("td",{staticStyle:{"text-align":"left"}},[t._v("text")]),t._v(" "),s("td",{staticStyle:{"text-align":"left"}},[t._v("文本内容")])])])]),t._v(" "),s("h2",{attrs:{id:"vue中全局注册"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vue中全局注册"}},[t._v("#")]),t._v(" vue中全局注册")]),t._v(" "),s("div",{staticClass:"language-js line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 引入")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("AST")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'trans-ast'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 注册")]),t._v("\nvue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("AST")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" $"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("AST")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使用")]),t._v("\nvm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("AST")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("parseAST")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("template"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nvm"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$"),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("AST")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("parseDOM")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("AST")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br")])])])}),[],!1,null,null,null);a.default=n.exports}}]);